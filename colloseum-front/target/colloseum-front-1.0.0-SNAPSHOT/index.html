<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Togo Time</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="http://twitter.github.com/bootstrap/assets/css/bootstrap.css" rel="stylesheet">
    <link href="http://twitter.github.com/bootstrap/assets/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="http://twitter.github.com/bootstrap/assets/css/docs.css" rel="stylesheet">
    <link href="http://twitter.github.com/bootstrap/assets/js/google-code-prettify/prettify.css" rel="stylesheet">
    
    <link href="css/togo-time.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="assets/js/html5shiv.js"></script>
    <![endif]-->
    
    <script type="text/javascript" src="javascript/jQueryWithoutDollar-1.6.4.min.js"></script>

	<title>Colloseum</title>

</head>

  <body>
  
	  <script>
	  	$jq = jQuery.noConflict();
	  	var publit = new Object();
	  	var progress = false;
	  	var timer;
	  </script>
		
	<div id="jumbo" class="jumbotron masthead">
	
	  <div class="container">
	    <h2><span id="time">Time's Up</span></h2>
	    
	   <br/>
	   <br/>
	     
	    <p>
	      <a id="nxt" href="javascript:void(0)" class="btn btn-primary btn-large ">TIA</a>
	    </p>
	    <ul class="masthead-links">
			<li id="lnk"></li>
	    </ul>
	  </div>
	  
	</div>
	
	<script>
	
	function done( publit ) {
		
		publit.canRender = false;
		
		$jq.ajax( {
			type: "put",
			url:"http://www.occam.be/colloseum/rs/publits/" + publit.id,
			dataType: "json",
			contentType: "application/json",
			data: JSON.stringify( publit ),
		    dataType:"json",
			success: function( publit ) {
				
			  }
	
			}
		);
		
	}
	
	function decrease( div, button, value, publit, links ) {

		button.html( "" +  value );
		
		if ( value > 0 ) {
			
			var timer = setTimeout( function() {
				decrease( div, button, value -1, publit, links )
			}, 1000 );
			
			if ( value == 11 ) {
				
				// alert("10");
				button.removeClass("btn-success").addClass("btn-warning");
				
				div.append( $jq( "<audio>" ).attr("id","snd").attr("autoplay","autoplay").attr( "src","http://www.freesound.org/data/previews/82/82986_7037-lq.mp3" ) );
				
			}
			
		}
		else {
			
			button.removeClass("btn-warning").addClass("btn-danger");
			
			done( publit );
			
			if ( publit.play ) {
				
				links.html( $jq("<a/>").attr("href", publit.play ).html("hit me") );
				
			}
			else {
				links.html( $jq("<a/>").attr("href", "javascript:window.location.reload()" ).html("hit me") );
				
			}
			
		}
	    
	}
	
	$jq("#nxt").click( function( ) {
		
		if ( progress == true ) {
			
			clearTimeout( timer );
			$jq("#snd").remove();
			progress = false;
			
		}
		else {

			$jq.ajax( {
					type: "get",
					url: "http://www.occam.be/colloseum/rs/publits?pick=true",
				    processData: false,
				    dataType:"json",
					success: function( publit ) {
						
						$jq("#time").html( publit.publit.title );
						
						$jq("#nxt").addClass( "btn-success" );
						progress = true;
						
						decrease( $jq("#jumbo"), $jq("#nxt"), 30, publit.publit, $jq("#lnk") );
						
					  }
			});
		}
	});
	
	</script>

</body>

</html>